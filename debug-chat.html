<!DOCTYPE html>
<html>
<head>
    <title>Chat Debug Tool</title>
</head>
<body>
    <h1>Chat Debug Tool</h1>
    <div id="status"></div>
    <button onclick="testBackend()">Test Backend</button>
    <button onclick="testAuth()">Test Auth</button>
    <button onclick="testChat()">Test Chat</button>
    
    <script>
        const status = document.getElementById('status');
        
        function log(message) {
            status.innerHTML += '<div>' + new Date().toISOString() + ': ' + message + '</div>';
            console.log(message);
        }
        
        async function testBackend() {
            log('üîç Testing backend health...');
            try {
                const response = await fetch('http://localhost:8000/health');
                log('Health status: ' + response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ Backend is healthy: ' + JSON.stringify(data));
                } else {
                    log('‚ùå Backend health check failed');
                }
            } catch (error) {
                log('‚ùå Backend test failed: ' + error.message);
            }
        }
        
        async function testAuth() {
            log('üîç Testing auth endpoint...');
            try {
                const response = await fetch('http://localhost:8000/api/v1/auth/me');
                log('Auth status: ' + response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ Auth working: ' + JSON.stringify(data));
                } else {
                    log('‚ùå Auth failed: ' + response.status);
                }
            } catch (error) {
                log('‚ùå Auth test failed: ' + error.message);
            }
        }
        
        async function testChat() {
            log('üîç Testing chat endpoint...');
            try {
                const response = await fetch('http://localhost:8000/api/v1/chat/stream', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream'
                    },
                    body: JSON.stringify({ message: 'Hello, test message' })
                });
                
                log('Chat status: ' + response.status);
                
                if (response.ok) {
                    log('‚úÖ Chat endpoint responding');
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    
                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        
                        const chunk = decoder.decode(value);
                        log('üì° Received chunk: ' + chunk.substring(0, 100));
                    }
                } else {
                    log('‚ùå Chat failed: ' + response.status);
                }
            } catch (error) {
                log('‚ùå Chat test failed: ' + error.message);
            }
        }
    </script>
</body>
</html>
